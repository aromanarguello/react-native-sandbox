882cc737da7c9de216b4f9c8fc789891
'use strict';

var Dimensions = require("../Utilities/Dimensions");

var FrameRateLogger = require("../Interaction/FrameRateLogger");

var Keyboard = require("./Keyboard/Keyboard");

var ReactNative = require("../Renderer/shims/ReactNative");

var TextInputState = require("./TextInput/TextInputState");

var UIManager = require("../ReactNative/UIManager");

var invariant = require('invariant');

var nullthrows = require('nullthrows');

var performanceNow = require('fbjs/lib/performanceNow');

var warning = require('fbjs/lib/warning');

var _require = require("../BatchedBridge/NativeModules"),
    ScrollViewManager = _require.ScrollViewManager;

var IS_ANIMATING_TOUCH_START_THRESHOLD_MS = 16;
var ScrollResponderMixin = {
  _subscriptionKeyboardWillShow: null,
  _subscriptionKeyboardWillHide: null,
  _subscriptionKeyboardDidShow: null,
  _subscriptionKeyboardDidHide: null,
  scrollResponderMixinGetInitialState: function scrollResponderMixinGetInitialState() {
    return {
      isTouching: false,
      lastMomentumScrollBeginTime: 0,
      lastMomentumScrollEndTime: 0,
      observedScrollSinceBecomingResponder: false,
      becameResponderWhileAnimating: false
    };
  },
  scrollResponderHandleScrollShouldSetResponder: function scrollResponderHandleScrollShouldSetResponder() {
    return this.state.isTouching;
  },
  scrollResponderHandleStartShouldSetResponder: function scrollResponderHandleStartShouldSetResponder(e) {
    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();

    if (this.props.keyboardShouldPersistTaps === 'handled' && currentlyFocusedTextInput != null && e.target !== currentlyFocusedTextInput) {
      return true;
    }

    return false;
  },
  scrollResponderHandleStartShouldSetResponderCapture: function scrollResponderHandleStartShouldSetResponderCapture(e) {
    if (this.scrollResponderIsAnimating()) {
      return true;
    }

    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();
    var keyboardShouldPersistTaps = this.props.keyboardShouldPersistTaps;
    var keyboardNeverPersistTaps = !keyboardShouldPersistTaps || keyboardShouldPersistTaps === 'never';

    if (keyboardNeverPersistTaps && currentlyFocusedTextInput != null && e.target && !TextInputState.isTextInput(e.target)) {
      return true;
    }

    return false;
  },
  scrollResponderHandleResponderReject: function scrollResponderHandleResponderReject() {},
  scrollResponderHandleTerminationRequest: function scrollResponderHandleTerminationRequest() {
    return !this.state.observedScrollSinceBecomingResponder;
  },
  scrollResponderHandleTouchEnd: function scrollResponderHandleTouchEnd(e) {
    var nativeEvent = e.nativeEvent;
    this.state.isTouching = nativeEvent.touches.length !== 0;
    this.props.onTouchEnd && this.props.onTouchEnd(e);
  },
  scrollResponderHandleTouchCancel: function scrollResponderHandleTouchCancel(e) {
    this.state.isTouching = false;
    this.props.onTouchCancel && this.props.onTouchCancel(e);
  },
  scrollResponderHandleResponderRelease: function scrollResponderHandleResponderRelease(e) {
    this.props.onResponderRelease && this.props.onResponderRelease(e);
    var currentlyFocusedTextInput = TextInputState.currentlyFocusedField();

    if (this.props.keyboardShouldPersistTaps !== true && this.props.keyboardShouldPersistTaps !== 'always' && currentlyFocusedTextInput != null && e.target !== currentlyFocusedTextInput && !this.state.observedScrollSinceBecomingResponder && !this.state.becameResponderWhileAnimating) {
      this.props.onScrollResponderKeyboardDismissed && this.props.onScrollResponderKeyboardDismissed(e);
      TextInputState.blurTextInput(currentlyFocusedTextInput);
    }
  },
  scrollResponderHandleScroll: function scrollResponderHandleScroll(e) {
    this.state.observedScrollSinceBecomingResponder = true;
    this.props.onScroll && this.props.onScroll(e);
  },
  scrollResponderHandleResponderGrant: function scrollResponderHandleResponderGrant(e) {
    this.state.observedScrollSinceBecomingResponder = false;
    this.props.onResponderGrant && this.props.onResponderGrant(e);
    this.state.becameResponderWhileAnimating = this.scrollResponderIsAnimating();
  },
  scrollResponderHandleScrollBeginDrag: function scrollResponderHandleScrollBeginDrag(e) {
    FrameRateLogger.beginScroll();
    this.props.onScrollBeginDrag && this.props.onScrollBeginDrag(e);
  },
  scrollResponderHandleScrollEndDrag: function scrollResponderHandleScrollEndDrag(e) {
    var velocity = e.nativeEvent.velocity;

    if (!this.scrollResponderIsAnimating() && (!velocity || velocity.x === 0 && velocity.y === 0)) {
      FrameRateLogger.endScroll();
    }

    this.props.onScrollEndDrag && this.props.onScrollEndDrag(e);
  },
  scrollResponderHandleMomentumScrollBegin: function scrollResponderHandleMomentumScrollBegin(e) {
    this.state.lastMomentumScrollBeginTime = performanceNow();
    this.props.onMomentumScrollBegin && this.props.onMomentumScrollBegin(e);
  },
  scrollResponderHandleMomentumScrollEnd: function scrollResponderHandleMomentumScrollEnd(e) {
    FrameRateLogger.endScroll();
    this.state.lastMomentumScrollEndTime = performanceNow();
    this.props.onMomentumScrollEnd && this.props.onMomentumScrollEnd(e);
  },
  scrollResponderHandleTouchStart: function scrollResponderHandleTouchStart(e) {
    this.state.isTouching = true;
    this.props.onTouchStart && this.props.onTouchStart(e);
  },
  scrollResponderHandleTouchMove: function scrollResponderHandleTouchMove(e) {
    this.props.onTouchMove && this.props.onTouchMove(e);
  },
  scrollResponderIsAnimating: function scrollResponderIsAnimating() {
    var now = performanceNow();
    var timeSinceLastMomentumScrollEnd = now - this.state.lastMomentumScrollEndTime;
    var isAnimating = timeSinceLastMomentumScrollEnd < IS_ANIMATING_TOUCH_START_THRESHOLD_MS || this.state.lastMomentumScrollEndTime < this.state.lastMomentumScrollBeginTime;
    return isAnimating;
  },
  scrollResponderGetScrollableNode: function scrollResponderGetScrollableNode() {
    return this.getScrollableNode ? this.getScrollableNode() : ReactNative.findNodeHandle(this);
  },
  scrollResponderScrollTo: function scrollResponderScrollTo(x, y, animated) {
    if (typeof x === 'number') {
      console.warn('`scrollResponderScrollTo(x, y, animated)` is deprecated. Use `scrollResponderScrollTo({x: 5, y: 5, animated: true})` instead.');
    } else {
      var _ref = x || {};

      x = _ref.x;
      y = _ref.y;
      animated = _ref.animated;
    }

    UIManager.dispatchViewManagerCommand(nullthrows(this.scrollResponderGetScrollableNode()), UIManager.getViewManagerConfig('RCTScrollView').Commands.scrollTo, [x || 0, y || 0, animated !== false]);
  },
  scrollResponderScrollToEnd: function scrollResponderScrollToEnd(options) {
    var animated = (options && options.animated) !== false;
    UIManager.dispatchViewManagerCommand(this.scrollResponderGetScrollableNode(), UIManager.getViewManagerConfig('RCTScrollView').Commands.scrollToEnd, [animated]);
  },
  scrollResponderScrollWithoutAnimationTo: function scrollResponderScrollWithoutAnimationTo(offsetX, offsetY) {
    console.warn('`scrollResponderScrollWithoutAnimationTo` is deprecated. Use `scrollResponderScrollTo` instead');
    this.scrollResponderScrollTo({
      x: offsetX,
      y: offsetY,
      animated: false
    });
  },
  scrollResponderZoomTo: function scrollResponderZoomTo(rect, animated) {
    invariant(ScrollViewManager && ScrollViewManager.zoomToRect, 'zoomToRect is not implemented');

    if ('animated' in rect) {
      animated = rect.animated;
      delete rect.animated;
    } else if (typeof animated !== 'undefined') {
      console.warn('`scrollResponderZoomTo` `animated` argument is deprecated. Use `options.animated` instead');
    }

    ScrollViewManager.zoomToRect(this.scrollResponderGetScrollableNode(), rect, animated !== false);
  },
  scrollResponderFlashScrollIndicators: function scrollResponderFlashScrollIndicators() {
    UIManager.dispatchViewManagerCommand(this.scrollResponderGetScrollableNode(), UIManager.getViewManagerConfig('RCTScrollView').Commands.flashScrollIndicators, []);
  },
  scrollResponderScrollNativeHandleToKeyboard: function scrollResponderScrollNativeHandleToKeyboard(nodeHandle, additionalOffset, preventNegativeScrollOffset) {
    this.additionalScrollOffset = additionalOffset || 0;
    this.preventNegativeScrollOffset = !!preventNegativeScrollOffset;
    UIManager.measureLayout(nodeHandle, ReactNative.findNodeHandle(this.getInnerViewNode()), this.scrollResponderTextInputFocusError, this.scrollResponderInputMeasureAndScrollToKeyboard);
  },
  scrollResponderInputMeasureAndScrollToKeyboard: function scrollResponderInputMeasureAndScrollToKeyboard(left, top, width, height) {
    var keyboardScreenY = Dimensions.get('window').height;

    if (this.keyboardWillOpenTo) {
      keyboardScreenY = this.keyboardWillOpenTo.endCoordinates.screenY;
    }

    var scrollOffsetY = top - keyboardScreenY + height + this.additionalScrollOffset;

    if (this.preventNegativeScrollOffset) {
      scrollOffsetY = Math.max(0, scrollOffsetY);
    }

    this.scrollResponderScrollTo({
      x: 0,
      y: scrollOffsetY,
      animated: true
    });
    this.additionalOffset = 0;
    this.preventNegativeScrollOffset = false;
  },
  scrollResponderTextInputFocusError: function scrollResponderTextInputFocusError(msg) {
    console.error('Error measuring text field: ', msg);
  },
  UNSAFE_componentWillMount: function UNSAFE_componentWillMount() {
    var keyboardShouldPersistTaps = this.props.keyboardShouldPersistTaps;
    warning(typeof keyboardShouldPersistTaps !== 'boolean', "'keyboardShouldPersistTaps={" + keyboardShouldPersistTaps + "}' is deprecated. " + ("Use 'keyboardShouldPersistTaps=\"" + (keyboardShouldPersistTaps ? 'always' : 'never') + "\"' instead"));
    this.keyboardWillOpenTo = null;
    this.additionalScrollOffset = 0;
    this._subscriptionKeyboardWillShow = Keyboard.addListener('keyboardWillShow', this.scrollResponderKeyboardWillShow);
    this._subscriptionKeyboardWillHide = Keyboard.addListener('keyboardWillHide', this.scrollResponderKeyboardWillHide);
    this._subscriptionKeyboardDidShow = Keyboard.addListener('keyboardDidShow', this.scrollResponderKeyboardDidShow);
    this._subscriptionKeyboardDidHide = Keyboard.addListener('keyboardDidHide', this.scrollResponderKeyboardDidHide);
  },
  componentWillUnmount: function componentWillUnmount() {
    if (this._subscriptionKeyboardWillShow != null) {
      this._subscriptionKeyboardWillShow.remove();
    }

    if (this._subscriptionKeyboardWillHide != null) {
      this._subscriptionKeyboardWillHide.remove();
    }

    if (this._subscriptionKeyboardDidShow != null) {
      this._subscriptionKeyboardDidShow.remove();
    }

    if (this._subscriptionKeyboardDidHide != null) {
      this._subscriptionKeyboardDidHide.remove();
    }
  },
  scrollResponderKeyboardWillShow: function scrollResponderKeyboardWillShow(e) {
    this.keyboardWillOpenTo = e;
    this.props.onKeyboardWillShow && this.props.onKeyboardWillShow(e);
  },
  scrollResponderKeyboardWillHide: function scrollResponderKeyboardWillHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardWillHide && this.props.onKeyboardWillHide(e);
  },
  scrollResponderKeyboardDidShow: function scrollResponderKeyboardDidShow(e) {
    if (e) {
      this.keyboardWillOpenTo = e;
    }

    this.props.onKeyboardDidShow && this.props.onKeyboardDidShow(e);
  },
  scrollResponderKeyboardDidHide: function scrollResponderKeyboardDidHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardDidHide && this.props.onKeyboardDidHide(e);
  }
};
var ScrollResponder = {
  Mixin: ScrollResponderMixin
};
module.exports = ScrollResponder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNjcm9sbFJlc3BvbmRlci5qcyJdLCJuYW1lcyI6WyJEaW1lbnNpb25zIiwicmVxdWlyZSIsIkZyYW1lUmF0ZUxvZ2dlciIsIktleWJvYXJkIiwiUmVhY3ROYXRpdmUiLCJUZXh0SW5wdXRTdGF0ZSIsIlVJTWFuYWdlciIsImludmFyaWFudCIsIm51bGx0aHJvd3MiLCJwZXJmb3JtYW5jZU5vdyIsIndhcm5pbmciLCJTY3JvbGxWaWV3TWFuYWdlciIsIklTX0FOSU1BVElOR19UT1VDSF9TVEFSVF9USFJFU0hPTERfTVMiLCJTY3JvbGxSZXNwb25kZXJNaXhpbiIsIl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93IiwiX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUiLCJfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93IiwiX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZSIsInNjcm9sbFJlc3BvbmRlck1peGluR2V0SW5pdGlhbFN0YXRlIiwiaXNUb3VjaGluZyIsImxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSIsImxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUiLCJvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIiLCJiZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbFNob3VsZFNldFJlc3BvbmRlciIsInN0YXRlIiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlU3RhcnRTaG91bGRTZXRSZXNwb25kZXIiLCJlIiwiY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCIsImN1cnJlbnRseUZvY3VzZWRGaWVsZCIsInByb3BzIiwia2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyIsInRhcmdldCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSIsInNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nIiwia2V5Ym9hcmROZXZlclBlcnNpc3RUYXBzIiwiaXNUZXh0SW5wdXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWplY3QiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUZXJtaW5hdGlvblJlcXVlc3QiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaEVuZCIsIm5hdGl2ZUV2ZW50IiwidG91Y2hlcyIsImxlbmd0aCIsIm9uVG91Y2hFbmQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaENhbmNlbCIsIm9uVG91Y2hDYW5jZWwiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWxlYXNlIiwib25SZXNwb25kZXJSZWxlYXNlIiwib25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZCIsImJsdXJUZXh0SW5wdXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGwiLCJvblNjcm9sbCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlckdyYW50Iiwib25SZXNwb25kZXJHcmFudCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbEJlZ2luRHJhZyIsImJlZ2luU2Nyb2xsIiwib25TY3JvbGxCZWdpbkRyYWciLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxFbmREcmFnIiwidmVsb2NpdHkiLCJ4IiwieSIsImVuZFNjcm9sbCIsIm9uU2Nyb2xsRW5kRHJhZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZU1vbWVudHVtU2Nyb2xsQmVnaW4iLCJvbk1vbWVudHVtU2Nyb2xsQmVnaW4iLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVNb21lbnR1bVNjcm9sbEVuZCIsIm9uTW9tZW50dW1TY3JvbGxFbmQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaFN0YXJ0Iiwib25Ub3VjaFN0YXJ0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hNb3ZlIiwib25Ub3VjaE1vdmUiLCJub3ciLCJ0aW1lU2luY2VMYXN0TW9tZW50dW1TY3JvbGxFbmQiLCJpc0FuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlIiwiZ2V0U2Nyb2xsYWJsZU5vZGUiLCJmaW5kTm9kZUhhbmRsZSIsInNjcm9sbFJlc3BvbmRlclNjcm9sbFRvIiwiYW5pbWF0ZWQiLCJjb25zb2xlIiwid2FybiIsImRpc3BhdGNoVmlld01hbmFnZXJDb21tYW5kIiwiZ2V0Vmlld01hbmFnZXJDb25maWciLCJDb21tYW5kcyIsInNjcm9sbFRvIiwic2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG9FbmQiLCJvcHRpb25zIiwic2Nyb2xsVG9FbmQiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxXaXRob3V0QW5pbWF0aW9uVG8iLCJvZmZzZXRYIiwib2Zmc2V0WSIsInNjcm9sbFJlc3BvbmRlclpvb21UbyIsInJlY3QiLCJ6b29tVG9SZWN0Iiwic2Nyb2xsUmVzcG9uZGVyRmxhc2hTY3JvbGxJbmRpY2F0b3JzIiwiZmxhc2hTY3JvbGxJbmRpY2F0b3JzIiwic2Nyb2xsUmVzcG9uZGVyU2Nyb2xsTmF0aXZlSGFuZGxlVG9LZXlib2FyZCIsIm5vZGVIYW5kbGUiLCJhZGRpdGlvbmFsT2Zmc2V0IiwicHJldmVudE5lZ2F0aXZlU2Nyb2xsT2Zmc2V0IiwiYWRkaXRpb25hbFNjcm9sbE9mZnNldCIsIm1lYXN1cmVMYXlvdXQiLCJnZXRJbm5lclZpZXdOb2RlIiwic2Nyb2xsUmVzcG9uZGVyVGV4dElucHV0Rm9jdXNFcnJvciIsInNjcm9sbFJlc3BvbmRlcklucHV0TWVhc3VyZUFuZFNjcm9sbFRvS2V5Ym9hcmQiLCJsZWZ0IiwidG9wIiwid2lkdGgiLCJoZWlnaHQiLCJrZXlib2FyZFNjcmVlblkiLCJnZXQiLCJrZXlib2FyZFdpbGxPcGVuVG8iLCJlbmRDb29yZGluYXRlcyIsInNjcmVlblkiLCJzY3JvbGxPZmZzZXRZIiwiTWF0aCIsIm1heCIsIm1zZyIsImVycm9yIiwiVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCIsImFkZExpc3RlbmVyIiwic2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsU2hvdyIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbEhpZGUiLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZFNob3ciLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZEhpZGUiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInJlbW92ZSIsIm9uS2V5Ym9hcmRXaWxsU2hvdyIsIm9uS2V5Ym9hcmRXaWxsSGlkZSIsIm9uS2V5Ym9hcmREaWRTaG93Iiwib25LZXlib2FyZERpZEhpZGUiLCJTY3JvbGxSZXNwb25kZXIiLCJNaXhpbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBOztBQUVBLElBQU1BLFVBQVUsR0FBR0MsT0FBTywyQkFBMUI7O0FBQ0EsSUFBTUMsZUFBZSxHQUFHRCxPQUFPLGtDQUEvQjs7QUFDQSxJQUFNRSxRQUFRLEdBQUdGLE9BQU8sdUJBQXhCOztBQUNBLElBQU1HLFdBQVcsR0FBR0gsT0FBTyxpQ0FBM0I7O0FBQ0EsSUFBTUksY0FBYyxHQUFHSixPQUFPLDhCQUE5Qjs7QUFDQSxJQUFNSyxTQUFTLEdBQUdMLE9BQU8sNEJBQXpCOztBQUVBLElBQU1NLFNBQVMsR0FBR04sT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBQ0EsSUFBTU8sVUFBVSxHQUFHUCxPQUFPLENBQUMsWUFBRCxDQUExQjs7QUFDQSxJQUFNUSxjQUFjLEdBQUdSLE9BQU8sQ0FBQyx5QkFBRCxDQUE5Qjs7QUFDQSxJQUFNUyxPQUFPLEdBQUdULE9BQU8sQ0FBQyxrQkFBRCxDQUF2Qjs7ZUFFNEJBLE9BQU8sa0M7SUFBNUJVLGlCLFlBQUFBLGlCOztBQW9GUCxJQUFNQyxxQ0FBcUMsR0FBRyxFQUE5QztBQVVBLElBQU1DLG9CQUFvQixHQUFHO0FBQzNCQyxFQUFBQSw2QkFBNkIsRUFBRyxJQURMO0FBRTNCQyxFQUFBQSw2QkFBNkIsRUFBRyxJQUZMO0FBRzNCQyxFQUFBQSw0QkFBNEIsRUFBRyxJQUhKO0FBSTNCQyxFQUFBQSw0QkFBNEIsRUFBRyxJQUpKO0FBSzNCQyxFQUFBQSxtQ0FBbUMsRUFBRSwrQ0FBa0I7QUFDckQsV0FBTztBQUNMQyxN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QUtuRyxLQUFMLENBQVdtRyxpQkFBWCxDQUE2QnRHLENBQTdCLENBQWhDO0FBQ0QsR0E3akIwQjtBQStqQjNCaUcsRUFBQUEsOEJBQThCLEVBQUUsd0NBQVNqRyxDQUFULEVBQTJCO0FBQ3pELFNBQUtvRixrQkFBTCxHQUEwQixJQUExQjtBQUNBLFNBQUtqRixLQUFMLENBQVdvRyxpQkFBWCxJQUFnQyxLQUFLcEcsS0FBTCxDQUFXb0csaUJBQVgsQ0FBNkJ2RyxDQUE3QixDQUFoQztBQUNEO0FBbGtCMEIsQ0FBN0I7QUFxa0JBLElBQU13RyxlQUFlLEdBQUc7QUFDdEJDLEVBQUFBLEtBQUssRUFBRXZIO0FBRGUsQ0FBeEI7QUFJQXdILE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQkgsZUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmb3JtYXRcbiAqIEBmbG93XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBEaW1lbnNpb25zID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL0RpbWVuc2lvbnMnKTtcbmNvbnN0IEZyYW1lUmF0ZUxvZ2dlciA9IHJlcXVpcmUoJy4uL0ludGVyYWN0aW9uL0ZyYW1lUmF0ZUxvZ2dlcicpO1xuY29uc3QgS2V5Ym9hcmQgPSByZXF1aXJlKCcuL0tleWJvYXJkL0tleWJvYXJkJyk7XG5jb25zdCBSZWFjdE5hdGl2ZSA9IHJlcXVpcmUoJy4uL1JlbmRlcmVyL3NoaW1zL1JlYWN0TmF0aXZlJyk7XG5jb25zdCBUZXh0SW5wdXRTdGF0ZSA9IHJlcXVpcmUoJy4vVGV4dElucHV0L1RleHRJbnB1dFN0YXRlJyk7XG5jb25zdCBVSU1hbmFnZXIgPSByZXF1aXJlKCcuLi9SZWFjdE5hdGl2ZS9VSU1hbmFnZXInKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5jb25zdCBudWxsdGhyb3dzID0gcmVxdWlyZSgnbnVsbHRocm93cycpO1xuY29uc3QgcGVyZm9ybWFuY2VOb3cgPSByZXF1aXJlKCdmYmpzL2xpYi9wZXJmb3JtYW5jZU5vdycpO1xuY29uc3Qgd2FybmluZyA9IHJlcXVpcmUoJ2ZianMvbGliL3dhcm5pbmcnKTtcblxuY29uc3Qge1Njcm9sbFZpZXdNYW5hZ2VyfSA9IHJlcXVpcmUoJy4uL0JhdGNoZWRCcmlkZ2UvTmF0aXZlTW9kdWxlcycpO1xuXG5pbXBvcnQgdHlwZSB7UHJlc3NFdmVudCwgU2Nyb2xsRXZlbnR9IGZyb20gJy4uL1R5cGVzL0NvcmVFdmVudFR5cGVzJztcbmltcG9ydCB0eXBlIHtLZXlib2FyZEV2ZW50fSBmcm9tICcuL0tleWJvYXJkL0tleWJvYXJkJztcbmltcG9ydCB0eXBlIEVtaXR0ZXJTdWJzY3JpcHRpb24gZnJvbSAnLi4vdmVuZG9yL2VtaXR0ZXIvRW1pdHRlclN1YnNjcmlwdGlvbic7XG5cbi8qKlxuICogTWl4aW4gdGhhdCBjYW4gYmUgaW50ZWdyYXRlZCBpbiBvcmRlciB0byBoYW5kbGUgc2Nyb2xsaW5nIHRoYXQgcGxheXMgd2VsbFxuICogd2l0aCBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLiBJbnRlZ3JhdGUgd2l0aCB5b3VyIHBsYXRmb3JtIHNwZWNpZmljIHNjcm9sbFxuICogdmlld3MsIG9yIGV2ZW4geW91ciBjdXN0b20gYnVpbHQgKGV2ZXJ5LWZyYW1lIGFuaW1hdGluZykgc2Nyb2xsIHZpZXdzIHNvIHRoYXRcbiAqIGFsbCBvZiB0aGVzZSBzeXN0ZW1zIHBsYXkgd2VsbCB3aXRoIHRoZSBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLlxuICpcbiAqIGlPUyBzY3JvbGwgZXZlbnQgdGltaW5nIG51YW5jZXM6XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKlxuICpcbiAqIFNjcm9sbGluZyB3aXRob3V0IGJvdW5jaW5nLCBpZiB5b3UgdG91Y2ggZG93bjpcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqXG4gKiAxLiBgb25Nb21lbnR1bVNjcm9sbEJlZ2luYCAod2hlbiBhbmltYXRpb24gYmVnaW5zIGFmdGVyIGxldHRpbmcgdXApXG4gKiAgICAuLi4gcGh5c2ljYWwgdG91Y2ggc3RhcnRzIC4uLlxuICogMi4gYG9uVG91Y2hTdGFydENhcHR1cmVgICAgKHdoZW4geW91IHByZXNzIGRvd24gdG8gc3RvcCB0aGUgc2Nyb2xsKVxuICogMy4gYG9uVG91Y2hTdGFydGAgICAgICAgICAgKHNhbWUsIGJ1dCBidWJibGUgcGhhc2UpXG4gKiA0LiBgb25SZXNwb25kZXJSZWxlYXNlYCAgICAod2hlbiBsaWZ0aW5nIHVwIC0geW91IGNvdWxkIHBhdXNlIGZvcmV2ZXIgYmVmb3JlICogbGlmdGluZylcbiAqIDUuIGBvbk1vbWVudHVtU2Nyb2xsRW5kYFxuICpcbiAqXG4gKiBTY3JvbGxpbmcgd2l0aCBib3VuY2luZywgaWYgeW91IHRvdWNoIGRvd246XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKlxuICogMS4gYG9uTW9tZW50dW1TY3JvbGxCZWdpbmAgKHdoZW4gYW5pbWF0aW9uIGJlZ2lucyBhZnRlciBsZXR0aW5nIHVwKVxuICogICAgLi4uIGJvdW5jZSBiZWdpbnMgLi4uXG4gKiAgICAuLi4gc29tZSB0aW1lIGVsYXBzZXMgLi4uXG4gKiAgICAuLi4gcGh5c2ljYWwgdG91Y2ggZHVyaW5nIGJvdW5jZSAuLi5cbiAqIDIuIGBvbk1vbWVudHVtU2Nyb2xsRW5kYCAgIChNYWtlcyBubyBzZW5zZSB3aHkgdGhpcyBvY2N1cnMgZmlyc3QgZHVyaW5nIGJvdW5jZSlcbiAqIDMuIGBvblRvdWNoU3RhcnRDYXB0dXJlYCAgIChpbW1lZGlhdGVseSBhZnRlciBgb25Nb21lbnR1bVNjcm9sbEVuZGApXG4gKiA0LiBgb25Ub3VjaFN0YXJ0YCAgICAgICAgICAoc2FtZSwgYnV0IGJ1YmJsZSBwaGFzZSlcbiAqIDUuIGBvblRvdWNoRW5kYCAgICAgICAgICAgIChZb3UgY291bGQgaG9sZCB0aGUgdG91Y2ggc3RhcnQgZm9yIGEgbG9uZyB0aW1lKVxuICogNi4gYG9uTW9tZW50dW1TY3JvbGxCZWdpbmAgKFdoZW4gcmVsZWFzaW5nIHRoZSB2aWV3IHN0YXJ0cyBib3VuY2luZyBiYWNrKVxuICpcbiAqIFNvIHdoZW4gd2UgcmVjZWl2ZSBhbiBgb25Ub3VjaFN0YXJ0YCwgaG93IGNhbiB3ZSB0ZWxsIGlmIHdlIGFyZSB0b3VjaGluZ1xuICogKmR1cmluZyogYW4gYW5pbWF0aW9uICh3aGljaCB0aGVuIGNhdXNlcyB0aGUgYW5pbWF0aW9uIHRvIHN0b3ApPyBUaGUgb25seSB3YXlcbiAqIHRvIHRlbGwgaXMgaWYgdGhlIGB0b3VjaFN0YXJ0YCBvY2N1cnJlZCBpbW1lZGlhdGVseSBhZnRlciB0aGVcbiAqIGBvbk1vbWVudHVtU2Nyb2xsRW5kYC5cbiAqXG4gKiBUaGlzIGlzIGFic3RyYWN0ZWQgb3V0IGZvciB5b3UsIHNvIHlvdSBjYW4ganVzdCBjYWxsIHRoaXMuc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmcoKSBpZlxuICogbmVjZXNzYXJ5XG4gKlxuICogYFNjcm9sbFJlc3BvbmRlcmAgYWxzbyBpbmNsdWRlcyBsb2dpYyBmb3IgYmx1cnJpbmcgYSBjdXJyZW50bHkgZm9jdXNlZCBpbnB1dFxuICogaWYgb25lIGlzIGZvY3VzZWQgd2hpbGUgc2Nyb2xsaW5nLiBUaGUgYFNjcm9sbFJlc3BvbmRlcmAgaXMgYSBuYXR1cmFsIHBsYWNlXG4gKiB0byBwdXQgdGhpcyBsb2dpYyBzaW5jZSBpdCBjYW4gc3VwcG9ydCBub3QgZGlzbWlzc2luZyB0aGUga2V5Ym9hcmQgd2hpbGVcbiAqIHNjcm9sbGluZywgdW5sZXNzIGEgcmVjb2duaXplZCBcInRhcFwiLWxpa2UgZ2VzdHVyZSBoYXMgb2NjdXJyZWQuXG4gKlxuICogVGhlIHB1YmxpYyBsaWZlY3ljbGUgQVBJIGluY2x1ZGVzIGV2ZW50cyBmb3Iga2V5Ym9hcmQgaW50ZXJhY3Rpb24sIHJlc3BvbmRlclxuICogaW50ZXJhY3Rpb24sIGFuZCBzY3JvbGxpbmcgKGFtb25nIG90aGVycykuIFRoZSBrZXlib2FyZCBjYWxsYmFja3NcbiAqIGBvbktleWJvYXJkV2lsbC9EaWQvKmAgYXJlICpnbG9iYWwqIGV2ZW50cywgYnV0IGFyZSBpbnZva2VkIG9uIHNjcm9sbFxuICogcmVzcG9uZGVyJ3MgcHJvcHMgc28gdGhhdCB5b3UgY2FuIGd1YXJhbnRlZSB0aGF0IHRoZSBzY3JvbGwgcmVzcG9uZGVyJ3NcbiAqIGludGVybmFsIHN0YXRlIGhhcyBiZWVuIHVwZGF0ZWQgYWNjb3JkaW5nbHkgKGFuZCBkZXRlcm1pbmlzdGljYWxseSkgYnlcbiAqIHRoZSB0aW1lIHRoZSBwcm9wcyBjYWxsYmFja3MgYXJlIGludm9rZS4gT3RoZXJ3aXNlLCB5b3Ugd291bGQgYWx3YXlzIHdvbmRlclxuICogaWYgdGhlIHNjcm9sbCByZXNwb25kZXIgaXMgY3VycmVudGx5IGluIGEgc3RhdGUgd2hlcmUgaXQgcmVjb2duaXplcyBuZXdcbiAqIGtleWJvYXJkIHBvc2l0aW9ucyBldGMuIElmIGNvb3JkaW5hdGluZyBzY3JvbGxpbmcgd2l0aCBrZXlib2FyZCBtb3ZlbWVudCxcbiAqICphbHdheXMqIHVzZSB0aGVzZSBob29rcyBpbnN0ZWFkIG9mIGxpc3RlbmluZyB0byB5b3VyIG93biBnbG9iYWwga2V5Ym9hcmRcbiAqIGV2ZW50cy5cbiAqXG4gKiBQdWJsaWMga2V5Ym9hcmQgbGlmZWN5Y2xlIEFQSTogKHByb3BzIGNhbGxiYWNrcylcbiAqXG4gKiBTdGFuZGFyZCBLZXlib2FyZCBBcHBlYXJhbmNlIFNlcXVlbmNlOlxuICpcbiAqICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3dcbiAqICAgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkU2hvd1xuICpcbiAqIGBvblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkYCB3aWxsIGJlIGludm9rZWQgaWYgYW4gYXBwcm9wcmlhdGVcbiAqIHRhcCBpbnNpZGUgdGhlIHNjcm9sbCByZXNwb25kZXIncyBzY3JvbGxhYmxlIHJlZ2lvbiB3YXMgcmVzcG9uc2libGVcbiAqIGZvciB0aGUgZGlzbWlzc2FsIG9mIHRoZSBrZXlib2FyZC4gVGhlcmUgYXJlIG90aGVyIHJlYXNvbnMgd2h5IHRoZVxuICoga2V5Ym9hcmQgY291bGQgYmUgZGlzbWlzc2VkLlxuICpcbiAqICAgdGhpcy5wcm9wcy5vblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkXG4gKlxuICogU3RhbmRhcmQgS2V5Ym9hcmQgSGlkZSBTZXF1ZW5jZTpcbiAqXG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxIaWRlXG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZERpZEhpZGVcbiAqL1xuXG5jb25zdCBJU19BTklNQVRJTkdfVE9VQ0hfU1RBUlRfVEhSRVNIT0xEX01TID0gMTY7XG5cbmV4cG9ydCB0eXBlIFN0YXRlID0ge3xcbiAgaXNUb3VjaGluZzogYm9vbGVhbixcbiAgbGFzdE1vbWVudHVtU2Nyb2xsQmVnaW5UaW1lOiBudW1iZXIsXG4gIGxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWU6IG51bWJlcixcbiAgb2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyOiBib29sZWFuLFxuICBiZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZzogYm9vbGVhbixcbnx9O1xuXG5jb25zdCBTY3JvbGxSZXNwb25kZXJNaXhpbiA9IHtcbiAgX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3c6IChudWxsOiA/RW1pdHRlclN1YnNjcmlwdGlvbiksXG4gIF9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxIaWRlOiAobnVsbDogP0VtaXR0ZXJTdWJzY3JpcHRpb24pLFxuICBfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93OiAobnVsbDogP0VtaXR0ZXJTdWJzY3JpcHRpb24pLFxuICBfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlOiAobnVsbDogP0VtaXR0ZXJTdWJzY3JpcHRpb24pLFxuICBzY3JvbGxSZXNwb25kZXJNaXhpbkdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKTogU3RhdGUge1xuICAgIHJldHVybiB7XG4gICAgICBpc1RvdWNoaW5nOiBmYWxzZSxcbiAgICAgIGxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZTogMCxcbiAgICAgIGxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWU6IDAsXG5cbiAgICAgIC8vIFJlc2V0IHRvIGZhbHNlIGV2ZXJ5IHRpbWUgYmVjb21lcyByZXNwb25kZXIuIFRoaXMgaXMgdXNlZCB0bzpcbiAgICAgIC8vIC0gRGV0ZXJtaW5lIGlmIHRoZSBzY3JvbGwgdmlldyBoYXMgYmVlbiBzY3JvbGxlZCBhbmQgdGhlcmVmb3JlIHNob3VsZFxuICAgICAgLy8gcmVmdXNlIHRvIGdpdmUgdXAgaXRzIHJlc3BvbmRlciBsb2NrLlxuICAgICAgLy8gLSBEZXRlcm1pbmUgaWYgcmVsZWFzaW5nIHNob3VsZCBkaXNtaXNzIHRoZSBrZXlib2FyZCB3aGVuIHdlIGFyZSBpblxuICAgICAgLy8gdGFwLXRvLWRpc21pc3MgbW9kZSAodGhpcy5wcm9wcy5rZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSAnYWx3YXlzJykuXG4gICAgICBvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXI6IGZhbHNlLFxuICAgICAgYmVjYW1lUmVzcG9uZGVyV2hpbGVBbmltYXRpbmc6IGZhbHNlLFxuICAgIH07XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU2Nyb2xsYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbFNob3VsZFNldFJlc3BvbmRlcjogZnVuY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuaXNUb3VjaGluZztcbiAgfSxcblxuICAvKipcbiAgICogTWVyZWx5IHRvdWNoIHN0YXJ0aW5nIGlzIG5vdCBzdWZmaWNpZW50IGZvciBhIHNjcm9sbCB2aWV3IHRvIGJlY29tZSB0aGVcbiAgICogcmVzcG9uZGVyLiBCZWluZyB0aGUgXCJyZXNwb25kZXJcIiBtZWFucyB0aGF0IHRoZSB2ZXJ5IG5leHQgdG91Y2ggbW92ZS9lbmRcbiAgICogZXZlbnQgd2lsbCByZXN1bHQgaW4gYW4gYWN0aW9uL21vdmVtZW50LlxuICAgKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyYCBldmVudC5cbiAgICpcbiAgICogYG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJgIGlzIHVzZWQgd2hlbiB0aGUgbmV4dCBtb3ZlL2VuZCB3aWxsIHRyaWdnZXJcbiAgICogc29tZSBVSSBtb3ZlbWVudC9hY3Rpb24sIGJ1dCB3aGVuIHlvdSB3YW50IHRvIHlpZWxkIHByaW9yaXR5IHRvIHZpZXdzXG4gICAqIG5lc3RlZCBpbnNpZGUgb2YgdGhlIHZpZXcuXG4gICAqXG4gICAqIFRoZXJlIG1heSBiZSBzb21lIGNhc2VzIHdoZXJlIHNjcm9sbCB2aWV3cyBhY3R1YWxseSBzaG91bGQgcmV0dXJuIGB0cnVlYFxuICAgKiBmcm9tIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyYDogQW55IHRpbWUgd2UgYXJlIGRldGVjdGluZyBhIHN0YW5kYXJkIHRhcFxuICAgKiB0aGF0IGdpdmVzIHByaW9yaXR5IHRvIG5lc3RlZCB2aWV3cy5cbiAgICpcbiAgICogLSBJZiBhIHNpbmdsZSB0YXAgb24gdGhlIHNjcm9sbCB2aWV3IHRyaWdnZXJzIGFuIGFjdGlvbiBzdWNoIGFzXG4gICAqICAgcmVjZW50ZXJpbmcgYSBtYXAgc3R5bGUgdmlldyB5ZXQgd2FudHMgdG8gZ2l2ZSBwcmlvcml0eSB0byBpbnRlcmFjdGlvblxuICAgKiAgIHZpZXdzIGluc2lkZSAoc3VjaCBhcyBkcm9wcGVkIHBpbnMgb3IgbGFiZWxzKSwgdGhlbiB3ZSB3b3VsZCByZXR1cm4gdHJ1ZVxuICAgKiAgIGZyb20gdGhpcyBtZXRob2Qgd2hlbiB0aGVyZSBpcyBhIHNpbmdsZSB0b3VjaC5cbiAgICpcbiAgICogLSBTaW1pbGFyIHRvIHRoZSBwcmV2aW91cyBjYXNlLCBpZiBhIHR3byBmaW5nZXIgXCJ0YXBcIiBzaG91bGQgdHJpZ2dlciBhXG4gICAqICAgem9vbSwgd2Ugd291bGQgY2hlY2sgdGhlIGB0b3VjaGVzYCBjb3VudCwgYW5kIGlmIGA+PSAyYCwgd2Ugd291bGQgcmV0dXJuXG4gICAqICAgdHJ1ZS5cbiAgICpcbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyOiBmdW5jdGlvbihcbiAgICBlOiBQcmVzc0V2ZW50LFxuICApOiBib29sZWFuIHtcbiAgICBjb25zdCBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ID0gVGV4dElucHV0U3RhdGUuY3VycmVudGx5Rm9jdXNlZEZpZWxkKCk7XG5cbiAgICBpZiAoXG4gICAgICB0aGlzLnByb3BzLmtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPT09ICdoYW5kbGVkJyAmJlxuICAgICAgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAhPSBudWxsICYmXG4gICAgICBlLnRhcmdldCAhPT0gY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dFxuICAgICkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICAvKipcbiAgICogVGhlcmUgYXJlIHRpbWVzIHdoZW4gdGhlIHNjcm9sbCB2aWV3IHdhbnRzIHRvIGJlY29tZSB0aGUgcmVzcG9uZGVyXG4gICAqIChtZWFuaW5nIHJlc3BvbmQgdG8gdGhlIG5leHQgaW1tZWRpYXRlIGB0b3VjaFN0YXJ0L3RvdWNoRW5kYCksIGluIGEgd2F5XG4gICAqIHRoYXQgKmRvZXNuJ3QqIGdpdmUgcHJpb3JpdHkgdG8gbmVzdGVkIHZpZXdzIChoZW5jZSB0aGUgY2FwdHVyZSBwaGFzZSk6XG4gICAqXG4gICAqIC0gQ3VycmVudGx5IGFuaW1hdGluZy5cbiAgICogLSBUYXBwaW5nIGFueXdoZXJlIHRoYXQgaXMgbm90IGEgdGV4dCBpbnB1dCwgd2hpbGUgdGhlIGtleWJvYXJkIGlzXG4gICAqICAgdXAgKHdoaWNoIHNob3VsZCBkaXNtaXNzIHRoZSBrZXlib2FyZCkuXG4gICAqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZTogZnVuY3Rpb24oXG4gICAgZTogUHJlc3NFdmVudCxcbiAgKTogYm9vbGVhbiB7XG4gICAgLy8gVGhlIHNjcm9sbCB2aWV3IHNob3VsZCByZWNlaXZlIHRhcHMgaW5zdGVhZCBvZiBpdHMgZGVzY2VuZGFudHMgaWY6XG4gICAgLy8gKiBpdCBpcyBhbHJlYWR5IGFuaW1hdGluZy9kZWNlbGVyYXRpbmdcbiAgICBpZiAodGhpcy5zY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZygpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyAqIHRoZSBrZXlib2FyZCBpcyB1cCwga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyBpcyAnbmV2ZXInICh0aGUgZGVmYXVsdCksXG4gICAgLy8gYW5kIGEgbmV3IHRvdWNoIHN0YXJ0cyB3aXRoIGEgbm9uLXRleHRpbnB1dCB0YXJnZXQgKGluIHdoaWNoIGNhc2UgdGhlXG4gICAgLy8gZmlyc3QgdGFwIHNob3VsZCBiZSBzZW50IHRvIHRoZSBzY3JvbGwgdmlldyBhbmQgZGlzbWlzcyB0aGUga2V5Ym9hcmQsXG4gICAgLy8gdGhlbiB0aGUgc2Vjb25kIHRhcCBnb2VzIHRvIHRoZSBhY3R1YWwgaW50ZXJpb3IgdmlldylcbiAgICBjb25zdCBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ID0gVGV4dElucHV0U3RhdGUuY3VycmVudGx5Rm9jdXNlZEZpZWxkKCk7XG4gICAgY29uc3Qge2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHN9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBrZXlib2FyZE5ldmVyUGVyc2lzdFRhcHMgPVxuICAgICAgIWtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgfHwga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA9PT0gJ25ldmVyJztcbiAgICBpZiAoXG4gICAgICBrZXlib2FyZE5ldmVyUGVyc2lzdFRhcHMgJiZcbiAgICAgIGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgIT0gbnVsbCAmJlxuICAgICAgZS50YXJnZXQgJiZcbiAgICAgICFUZXh0SW5wdXRTdGF0ZS5pc1RleHRJbnB1dChlLnRhcmdldClcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25SZXNwb25kZXJSZWplY3RgIGV2ZW50LlxuICAgKlxuICAgKiBTb21lIG90aGVyIGVsZW1lbnQgaXMgbm90IHlpZWxkaW5nIGl0cyByb2xlIGFzIHJlc3BvbmRlci4gTm9ybWFsbHksIHdlJ2RcbiAgICoganVzdCBkaXNhYmxlIHRoZSBgVUlTY3JvbGxWaWV3YCwgYnV0IGEgdG91Y2ggaGFzIGFscmVhZHkgYmVnYW4gb24gaXQsIHRoZVxuICAgKiBgVUlTY3JvbGxWaWV3YCB3aWxsIG5vdCBhY2NlcHQgYmVpbmcgZGlzYWJsZWQgYWZ0ZXIgdGhhdC4gVGhlIGVhc2llc3RcbiAgICogc29sdXRpb24gZm9yIG5vdyBpcyB0byBhY2NlcHQgdGhlIGxpbWl0YXRpb24gb2YgZGlzYWxsb3dpbmcgdGhpc1xuICAgKiBhbHRvZ2V0aGVyLiBUbyBpbXByb3ZlIHRoaXMsIGZpbmQgYSB3YXkgdG8gZGlzYWJsZSB0aGUgYFVJU2Nyb2xsVmlld2AgYWZ0ZXJcbiAgICogYSB0b3VjaCBoYXMgYWxyZWFkeSBzdGFydGVkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVqZWN0OiBmdW5jdGlvbigpIHt9LFxuXG4gIC8qKlxuICAgKiBXZSB3aWxsIGFsbG93IHRoZSBzY3JvbGwgdmlldyB0byBnaXZlIHVwIGl0cyBsb2NrIGlmZiBpdCBhY3F1aXJlZCB0aGUgbG9ja1xuICAgKiBkdXJpbmcgYW4gYW5pbWF0aW9uLiBUaGlzIGlzIGEgdmVyeSB1c2VmdWwgZGVmYXVsdCB0aGF0IGhhcHBlbnMgdG8gc2F0aXNmeVxuICAgKiBtYW55IGNvbW1vbiB1c2VyIGV4cGVyaWVuY2VzLlxuICAgKlxuICAgKiAtIFN0b3AgYSBzY3JvbGwgb24gdGhlIGxlZnQgZWRnZSwgdGhlbiB0dXJuIHRoYXQgaW50byBhbiBvdXRlciB2aWV3J3NcbiAgICogICBiYWNrc3dpcGUuXG4gICAqIC0gU3RvcCBhIHNjcm9sbCBtaWQtYm91bmNlIGF0IHRoZSB0b3AsIGNvbnRpbnVlIHB1bGxpbmcgdG8gaGF2ZSB0aGUgb3V0ZXJcbiAgICogICB2aWV3IGRpc21pc3MuXG4gICAqIC0gSG93ZXZlciwgd2l0aG91dCBjYXRjaGluZyB0aGUgc2Nyb2xsIHZpZXcgbWlkLWJvdW5jZSAod2hpbGUgaXQgaXNcbiAgICogICBtb3Rpb25sZXNzKSwgaWYgeW91IGRyYWcgZmFyIGVub3VnaCBmb3IgdGhlIHNjcm9sbCB2aWV3IHRvIGJlY29tZVxuICAgKiAgIHJlc3BvbmRlciAoYW5kIHRoZXJlZm9yZSBkcmFnIHRoZSBzY3JvbGwgdmlldyBhIGJpdCksIGFueSBiYWNrc3dpcGVcbiAgICogICBuYXZpZ2F0aW9uIG9mIGEgc3dpcGUgZ2VzdHVyZSBoaWdoZXIgaW4gdGhlIHZpZXcgaGllcmFyY2h5LCBzaG91bGQgYmVcbiAgICogICByZWplY3RlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRlcm1pbmF0aW9uUmVxdWVzdDogZnVuY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLnN0YXRlLm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlcjtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaEVuZGAgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7UHJlc3NFdmVudH0gZSBFdmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoRW5kOiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgY29uc3QgbmF0aXZlRXZlbnQgPSBlLm5hdGl2ZUV2ZW50O1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IG5hdGl2ZUV2ZW50LnRvdWNoZXMubGVuZ3RoICE9PSAwO1xuICAgIHRoaXMucHJvcHMub25Ub3VjaEVuZCAmJiB0aGlzLnByb3BzLm9uVG91Y2hFbmQoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hDYW5jZWxgIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgRXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaENhbmNlbDogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IGZhbHNlO1xuICAgIHRoaXMucHJvcHMub25Ub3VjaENhbmNlbCAmJiB0aGlzLnByb3BzLm9uVG91Y2hDYW5jZWwoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uUmVzcG9uZGVyUmVsZWFzZWAgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWxlYXNlOiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UgJiYgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UoZSk7XG5cbiAgICAvLyBCeSBkZWZhdWx0IHNjcm9sbCB2aWV3cyB3aWxsIHVuZm9jdXMgYSB0ZXh0RmllbGRcbiAgICAvLyBpZiBhbm90aGVyIHRvdWNoIG9jY3VycyBvdXRzaWRlIG9mIGl0XG4gICAgY29uc3QgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCA9IFRleHRJbnB1dFN0YXRlLmN1cnJlbnRseUZvY3VzZWRGaWVsZCgpO1xuICAgIGlmIChcbiAgICAgIHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyAhPT0gdHJ1ZSAmJlxuICAgICAgdGhpcy5wcm9wcy5rZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSAnYWx3YXlzJyAmJlxuICAgICAgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAhPSBudWxsICYmXG4gICAgICBlLnRhcmdldCAhPT0gY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAmJlxuICAgICAgIXRoaXMuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyICYmXG4gICAgICAhdGhpcy5zdGF0ZS5iZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZ1xuICAgICkge1xuICAgICAgdGhpcy5wcm9wcy5vblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkICYmXG4gICAgICAgIHRoaXMucHJvcHMub25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZChlKTtcbiAgICAgIFRleHRJbnB1dFN0YXRlLmJsdXJUZXh0SW5wdXQoY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCk7XG4gICAgfVxuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbDogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlciA9IHRydWU7XG4gICAgdGhpcy5wcm9wcy5vblNjcm9sbCAmJiB0aGlzLnByb3BzLm9uU2Nyb2xsKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblJlc3BvbmRlckdyYW50YCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlckdyYW50OiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIHRoaXMuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyID0gZmFsc2U7XG4gICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlckdyYW50ICYmIHRoaXMucHJvcHMub25SZXNwb25kZXJHcmFudChlKTtcbiAgICB0aGlzLnN0YXRlLmJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nID0gdGhpcy5zY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZygpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBVbmZvcnR1bmF0ZWx5LCBgb25TY3JvbGxCZWdpbkRyYWdgIGFsc28gZmlyZXMgd2hlbiAqc3RvcHBpbmcqIHRoZSBzY3JvbGxcbiAgICogYW5pbWF0aW9uLCBhbmQgdGhlcmUncyBub3QgYW4gZWFzeSB3YXkgdG8gZGlzdGluZ3Vpc2ggYSBkcmFnIHZzLiBzdG9wcGluZ1xuICAgKiBtb21lbnR1bS5cbiAgICpcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TY3JvbGxCZWdpbkRyYWdgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsQmVnaW5EcmFnOiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIEZyYW1lUmF0ZUxvZ2dlci5iZWdpblNjcm9sbCgpOyAvLyBUT0RPOiB0cmFjayBhbGwgc2Nyb2xscyBhZnRlciBpbXBsZW1lbnRpbmcgb25TY3JvbGxFbmRBbmltYXRpb25cbiAgICB0aGlzLnByb3BzLm9uU2Nyb2xsQmVnaW5EcmFnICYmIHRoaXMucHJvcHMub25TY3JvbGxCZWdpbkRyYWcoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU2Nyb2xsRW5kRHJhZ2AgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxFbmREcmFnOiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIGNvbnN0IHt2ZWxvY2l0eX0gPSBlLm5hdGl2ZUV2ZW50O1xuICAgIC8vIC0gSWYgd2UgYXJlIGFuaW1hdGluZywgdGhlbiB0aGlzIGlzIGEgXCJkcmFnXCIgdGhhdCBpcyBzdG9wcGluZyB0aGUgc2Nyb2xsdmlldyBhbmQgbW9tZW50dW0gZW5kXG4gICAgLy8gICB3aWxsIGZpcmUuXG4gICAgLy8gLSBJZiB2ZWxvY2l0eSBpcyBub24temVybywgdGhlbiB0aGUgaW50ZXJhY3Rpb24gd2lsbCBzdG9wIHdoZW4gbW9tZW50dW0gc2Nyb2xsIGVuZHMgb3JcbiAgICAvLyAgIGFub3RoZXIgZHJhZyBzdGFydHMgYW5kIGVuZHMuXG4gICAgLy8gLSBJZiB3ZSBkb24ndCBnZXQgdmVsb2NpdHksIGJldHRlciB0byBzdG9wIHRoZSBpbnRlcmFjdGlvbiB0d2ljZSB0aGFuIG5vdCBzdG9wIGl0LlxuICAgIGlmIChcbiAgICAgICF0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCkgJiZcbiAgICAgICghdmVsb2NpdHkgfHwgKHZlbG9jaXR5LnggPT09IDAgJiYgdmVsb2NpdHkueSA9PT0gMCkpXG4gICAgKSB7XG4gICAgICBGcmFtZVJhdGVMb2dnZXIuZW5kU2Nyb2xsKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25TY3JvbGxFbmREcmFnICYmIHRoaXMucHJvcHMub25TY3JvbGxFbmREcmFnKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxCZWdpbjogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsQmVnaW4gJiYgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsQmVnaW4oZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uTW9tZW50dW1TY3JvbGxFbmRgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxFbmQ6IGZ1bmN0aW9uKGU6IFNjcm9sbEV2ZW50KSB7XG4gICAgRnJhbWVSYXRlTG9nZ2VyLmVuZFNjcm9sbCgpO1xuICAgIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZSA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsRW5kICYmIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEVuZChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaFN0YXJ0YCBldmVudC5cbiAgICpcbiAgICogU2luY2Ugd2Uga25vdyB0aGF0IHRoZSBgU2ltcGxlRXZlbnRQbHVnaW5gIG9jY3VycyBsYXRlciBpbiB0aGUgcGx1Z2luXG4gICAqIG9yZGVyLCBhZnRlciBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLCB3ZSBjYW4gZGV0ZWN0IHRoYXQgd2Ugd2VyZSAqbm90KlxuICAgKiBwZXJtaXR0ZWQgdG8gYmUgdGhlIHJlc3BvbmRlciAocHJlc3VtYWJseSBiZWNhdXNlIGEgY29udGFpbmVkIHZpZXcgYmVjYW1lXG4gICAqIHJlc3BvbmRlcikuIFRoZSBgb25SZXNwb25kZXJSZWplY3RgIHdvbid0IGZpcmUgaW4gdGhhdCBjYXNlIC0gaXQgb25seVxuICAgKiBmaXJlcyB3aGVuIGEgKmN1cnJlbnQqIHJlc3BvbmRlciByZWplY3RzIG91ciByZXF1ZXN0LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgVG91Y2ggU3RhcnQgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaFN0YXJ0OiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5pc1RvdWNoaW5nID0gdHJ1ZTtcbiAgICB0aGlzLnByb3BzLm9uVG91Y2hTdGFydCAmJiB0aGlzLnByb3BzLm9uVG91Y2hTdGFydChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaE1vdmVgIGV2ZW50LlxuICAgKlxuICAgKiBTaW5jZSB3ZSBrbm93IHRoYXQgdGhlIGBTaW1wbGVFdmVudFBsdWdpbmAgb2NjdXJzIGxhdGVyIGluIHRoZSBwbHVnaW5cbiAgICogb3JkZXIsIGFmdGVyIGBSZXNwb25kZXJFdmVudFBsdWdpbmAsIHdlIGNhbiBkZXRlY3QgdGhhdCB3ZSB3ZXJlICpub3QqXG4gICAqIHBlcm1pdHRlZCB0byBiZSB0aGUgcmVzcG9uZGVyIChwcmVzdW1hYmx5IGJlY2F1c2UgYSBjb250YWluZWQgdmlldyBiZWNhbWVcbiAgICogcmVzcG9uZGVyKS4gVGhlIGBvblJlc3BvbmRlclJlamVjdGAgd29uJ3QgZmlyZSBpbiB0aGF0IGNhc2UgLSBpdCBvbmx5XG4gICAqIGZpcmVzIHdoZW4gYSAqY3VycmVudCogcmVzcG9uZGVyIHJlamVjdHMgb3VyIHJlcXVlc3QuXG4gICAqXG4gICAqIEBwYXJhbSB7UHJlc3NFdmVudH0gZSBUb3VjaCBTdGFydCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoTW92ZTogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMucHJvcHMub25Ub3VjaE1vdmUgJiYgdGhpcy5wcm9wcy5vblRvdWNoTW92ZShlKTtcbiAgfSxcblxuICAvKipcbiAgICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIHRoaXMgY2xhc3MgdGhhdCBsZXRzIHVzIHF1aWNrbHkgZGV0ZXJtaW5lIGlmIHRoZVxuICAgKiB2aWV3IGlzIGN1cnJlbnRseSBhbmltYXRpbmcuIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCB0byBrbm93IHdoZW5cbiAgICogYSB0b3VjaCBoYXMganVzdCBzdGFydGVkIG9yIGVuZGVkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmc6IGZ1bmN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgY29uc3QgdGltZVNpbmNlTGFzdE1vbWVudHVtU2Nyb2xsRW5kID1cbiAgICAgIG5vdyAtIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZTtcbiAgICBjb25zdCBpc0FuaW1hdGluZyA9XG4gICAgICB0aW1lU2luY2VMYXN0TW9tZW50dW1TY3JvbGxFbmQgPCBJU19BTklNQVRJTkdfVE9VQ0hfU1RBUlRfVEhSRVNIT0xEX01TIHx8XG4gICAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUgPFxuICAgICAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZTtcbiAgICByZXR1cm4gaXNBbmltYXRpbmc7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG5vZGUgdGhhdCByZXByZXNlbnRzIG5hdGl2ZSB2aWV3IHRoYXQgY2FuIGJlIHNjcm9sbGVkLlxuICAgKiBDb21wb25lbnRzIGNhbiBwYXNzIHdoYXQgbm9kZSB0byB1c2UgYnkgZGVmaW5pbmcgYSBgZ2V0U2Nyb2xsYWJsZU5vZGVgXG4gICAqIGZ1bmN0aW9uIG90aGVyd2lzZSBgdGhpc2AgaXMgdXNlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlOiBmdW5jdGlvbigpOiA/bnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGxhYmxlTm9kZVxuICAgICAgPyB0aGlzLmdldFNjcm9sbGFibGVOb2RlKClcbiAgICAgIDogUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUodGhpcyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIHRvIHNjcm9sbCB0byBhIHNwZWNpZmljIHBvaW50IGluIHRoZSBTY3JvbGxWaWV3LlxuICAgKiBUaGlzIGlzIGN1cnJlbnRseSB1c2VkIHRvIGhlbHAgZm9jdXMgY2hpbGQgVGV4dFZpZXdzLCBidXQgY2FuIGFsc29cbiAgICogYmUgdXNlZCB0byBxdWlja2x5IHNjcm9sbCB0byBhbnkgZWxlbWVudCB3ZSB3YW50IHRvIGZvY3VzLiBTeW50YXg6XG4gICAqXG4gICAqIGBzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyhvcHRpb25zOiB7eDogbnVtYmVyID0gMDsgeTogbnVtYmVyID0gMDsgYW5pbWF0ZWQ6IGJvb2xlYW4gPSB0cnVlfSlgXG4gICAqXG4gICAqIE5vdGU6IFRoZSB3ZWlyZCBhcmd1bWVudCBzaWduYXR1cmUgaXMgZHVlIHRvIHRoZSBmYWN0IHRoYXQsIGZvciBoaXN0b3JpY2FsIHJlYXNvbnMsXG4gICAqIHRoZSBmdW5jdGlvbiBhbHNvIGFjY2VwdHMgc2VwYXJhdGUgYXJndW1lbnRzIGFzIGFzIGFsdGVybmF0aXZlIHRvIHRoZSBvcHRpb25zIG9iamVjdC5cbiAgICogVGhpcyBpcyBkZXByZWNhdGVkIGR1ZSB0byBhbWJpZ3VpdHkgKHkgYmVmb3JlIHgpLCBhbmQgU0hPVUxEIE5PVCBCRSBVU0VELlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG86IGZ1bmN0aW9uKFxuICAgIHg/OiBudW1iZXIgfCB7eD86IG51bWJlciwgeT86IG51bWJlciwgYW5pbWF0ZWQ/OiBib29sZWFufSxcbiAgICB5PzogbnVtYmVyLFxuICAgIGFuaW1hdGVkPzogYm9vbGVhbixcbiAgKSB7XG4gICAgaWYgKHR5cGVvZiB4ID09PSAnbnVtYmVyJykge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnYHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvKHgsIHksIGFuaW1hdGVkKWAgaXMgZGVwcmVjYXRlZC4gVXNlIGBzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh7eDogNSwgeTogNSwgYW5pbWF0ZWQ6IHRydWV9KWAgaW5zdGVhZC4nLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgKHt4LCB5LCBhbmltYXRlZH0gPSB4IHx8IHt9KTtcbiAgICB9XG4gICAgVUlNYW5hZ2VyLmRpc3BhdGNoVmlld01hbmFnZXJDb21tYW5kKFxuICAgICAgbnVsbHRocm93cyh0aGlzLnNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlKCkpLFxuICAgICAgVUlNYW5hZ2VyLmdldFZpZXdNYW5hZ2VyQ29uZmlnKCdSQ1RTY3JvbGxWaWV3JykuQ29tbWFuZHMuc2Nyb2xsVG8sXG4gICAgICBbeCB8fCAwLCB5IHx8IDAsIGFuaW1hdGVkICE9PSBmYWxzZV0sXG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogU2Nyb2xscyB0byB0aGUgZW5kIG9mIHRoZSBTY3JvbGxWaWV3LCBlaXRoZXIgaW1tZWRpYXRlbHkgb3Igd2l0aCBhIHNtb290aFxuICAgKiBhbmltYXRpb24uXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqXG4gICAqIGBzY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZCh7YW5pbWF0ZWQ6IHRydWV9KWBcbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvRW5kOiBmdW5jdGlvbihvcHRpb25zPzoge2FuaW1hdGVkPzogYm9vbGVhbn0pIHtcbiAgICAvLyBEZWZhdWx0IHRvIHRydWVcbiAgICBjb25zdCBhbmltYXRlZCA9IChvcHRpb25zICYmIG9wdGlvbnMuYW5pbWF0ZWQpICE9PSBmYWxzZTtcbiAgICBVSU1hbmFnZXIuZGlzcGF0Y2hWaWV3TWFuYWdlckNvbW1hbmQoXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlKCksXG4gICAgICBVSU1hbmFnZXIuZ2V0Vmlld01hbmFnZXJDb25maWcoJ1JDVFNjcm9sbFZpZXcnKS5Db21tYW5kcy5zY3JvbGxUb0VuZCxcbiAgICAgIFthbmltYXRlZF0sXG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogRGVwcmVjYXRlZCwgZG8gbm90IHVzZS5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbFdpdGhvdXRBbmltYXRpb25UbzogZnVuY3Rpb24oXG4gICAgb2Zmc2V0WDogbnVtYmVyLFxuICAgIG9mZnNldFk6IG51bWJlcixcbiAgKSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgJ2BzY3JvbGxSZXNwb25kZXJTY3JvbGxXaXRob3V0QW5pbWF0aW9uVG9gIGlzIGRlcHJlY2F0ZWQuIFVzZSBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG9gIGluc3RlYWQnLFxuICAgICk7XG4gICAgdGhpcy5zY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh7eDogb2Zmc2V0WCwgeTogb2Zmc2V0WSwgYW5pbWF0ZWQ6IGZhbHNlfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIHRvIHpvb20gdG8gYSBzcGVjaWZpYyByZWN0IGluIHRoZSBzY3JvbGx2aWV3LiBUaGUgYXJndW1lbnQgaGFzIHRoZSBzaGFwZVxuICAgKiB7eDogbnVtYmVyOyB5OiBudW1iZXI7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyOyBhbmltYXRlZDogYm9vbGVhbiA9IHRydWV9XG4gICAqXG4gICAqIEBwbGF0Zm9ybSBpb3NcbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclpvb21UbzogZnVuY3Rpb24oXG4gICAgcmVjdDoge3xcbiAgICAgIHg6IG51bWJlcixcbiAgICAgIHk6IG51bWJlcixcbiAgICAgIHdpZHRoOiBudW1iZXIsXG4gICAgICBoZWlnaHQ6IG51bWJlcixcbiAgICAgIGFuaW1hdGVkPzogYm9vbGVhbixcbiAgICB8fSxcbiAgICBhbmltYXRlZD86IGJvb2xlYW4sIC8vIGRlcHJlY2F0ZWQsIHB1dCB0aGlzIGluc2lkZSB0aGUgcmVjdCBhcmd1bWVudCBpbnN0ZWFkXG4gICkge1xuICAgIGludmFyaWFudChcbiAgICAgIFNjcm9sbFZpZXdNYW5hZ2VyICYmIFNjcm9sbFZpZXdNYW5hZ2VyLnpvb21Ub1JlY3QsXG4gICAgICAnem9vbVRvUmVjdCBpcyBub3QgaW1wbGVtZW50ZWQnLFxuICAgICk7XG4gICAgaWYgKCdhbmltYXRlZCcgaW4gcmVjdCkge1xuICAgICAgYW5pbWF0ZWQgPSByZWN0LmFuaW1hdGVkO1xuICAgICAgZGVsZXRlIHJlY3QuYW5pbWF0ZWQ7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgYW5pbWF0ZWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdgc2Nyb2xsUmVzcG9uZGVyWm9vbVRvYCBgYW5pbWF0ZWRgIGFyZ3VtZW50IGlzIGRlcHJlY2F0ZWQuIFVzZSBgb3B0aW9ucy5hbmltYXRlZGAgaW5zdGVhZCcsXG4gICAgICApO1xuICAgIH1cbiAgICBTY3JvbGxWaWV3TWFuYWdlci56b29tVG9SZWN0KFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJHZXRTY3JvbGxhYmxlTm9kZSgpLFxuICAgICAgcmVjdCxcbiAgICAgIGFuaW1hdGVkICE9PSBmYWxzZSxcbiAgICApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEaXNwbGF5cyB0aGUgc2Nyb2xsIGluZGljYXRvcnMgbW9tZW50YXJpbHkuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJGbGFzaFNjcm9sbEluZGljYXRvcnM6IGZ1bmN0aW9uKCkge1xuICAgIFVJTWFuYWdlci5kaXNwYXRjaFZpZXdNYW5hZ2VyQ29tbWFuZChcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyR2V0U2Nyb2xsYWJsZU5vZGUoKSxcbiAgICAgIFVJTWFuYWdlci5nZXRWaWV3TWFuYWdlckNvbmZpZygnUkNUU2Nyb2xsVmlldycpLkNvbW1hbmRzXG4gICAgICAgIC5mbGFzaFNjcm9sbEluZGljYXRvcnMsXG4gICAgICBbXSxcbiAgICApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgYmUgdXNlZCBhcyB0aGUgY2FsbGJhY2sgdG8gb25Gb2N1cyBpbiBhIFRleHRJbnB1dHMnXG4gICAqIHBhcmVudCB2aWV3LiBOb3RlIHRoYXQgYW55IG1vZHVsZSB1c2luZyB0aGlzIG1peGluIG5lZWRzIHRvIHJldHVyblxuICAgKiB0aGUgcGFyZW50IHZpZXcncyByZWYgaW4gZ2V0U2Nyb2xsVmlld1JlZigpIGluIG9yZGVyIHRvIHVzZSB0aGlzIG1ldGhvZC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IG5vZGVIYW5kbGUgVGhlIFRleHRJbnB1dCBub2RlIGhhbmRsZVxuICAgKiBAcGFyYW0ge251bWJlcn0gYWRkaXRpb25hbE9mZnNldCBUaGUgc2Nyb2xsIHZpZXcncyBib3R0b20gXCJjb250ZW50SW5zZXRcIi5cbiAgICogICAgICAgIERlZmF1bHQgaXMgMC5cbiAgICogQHBhcmFtIHtib29sfSBwcmV2ZW50TmVnYXRpdmVTY3JvbGxpbmcgV2hldGhlciB0byBhbGxvdyBwdWxsaW5nIHRoZSBjb250ZW50XG4gICAqICAgICAgICBkb3duIHRvIG1ha2UgaXQgbWVldCB0aGUga2V5Ym9hcmQncyB0b3AuIERlZmF1bHQgaXMgZmFsc2UuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJTY3JvbGxOYXRpdmVIYW5kbGVUb0tleWJvYXJkOiBmdW5jdGlvbihcbiAgICBub2RlSGFuZGxlOiBudW1iZXIsXG4gICAgYWRkaXRpb25hbE9mZnNldD86IG51bWJlcixcbiAgICBwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQ/OiBib29sZWFuLFxuICApIHtcbiAgICB0aGlzLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQgPSBhZGRpdGlvbmFsT2Zmc2V0IHx8IDA7XG4gICAgdGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQgPSAhIXByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldDtcbiAgICBVSU1hbmFnZXIubWVhc3VyZUxheW91dChcbiAgICAgIG5vZGVIYW5kbGUsXG4gICAgICBSZWFjdE5hdGl2ZS5maW5kTm9kZUhhbmRsZSh0aGlzLmdldElubmVyVmlld05vZGUoKSksXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlclRleHRJbnB1dEZvY3VzRXJyb3IsXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlcklucHV0TWVhc3VyZUFuZFNjcm9sbFRvS2V5Ym9hcmQsXG4gICAgKTtcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGNhbGN1bGF0aW9ucyBwZXJmb3JtZWQgaGVyZSBhc3N1bWUgdGhlIHNjcm9sbCB2aWV3IHRha2VzIHVwIHRoZSBlbnRpcmVcbiAgICogc2NyZWVuIC0gZXZlbiBpZiBoYXMgc29tZSBjb250ZW50IGluc2V0LiBXZSB0aGVuIG1lYXN1cmUgdGhlIG9mZnNldHMgb2YgdGhlXG4gICAqIGtleWJvYXJkLCBhbmQgY29tcGVuc2F0ZSBib3RoIGZvciB0aGUgc2Nyb2xsIHZpZXcncyBcImNvbnRlbnRJbnNldFwiLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gbGVmdCBQb3NpdGlvbiBvZiBpbnB1dCB3LnIudC4gdGFibGUgdmlldy5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHRvcCBQb3NpdGlvbiBvZiBpbnB1dCB3LnIudC4gdGFibGUgdmlldy5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIFdpZHRoIG9mIHRoZSB0ZXh0IGlucHV0LlxuICAgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IEhlaWdodCBvZiB0aGUgdGV4dCBpbnB1dC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlcklucHV0TWVhc3VyZUFuZFNjcm9sbFRvS2V5Ym9hcmQ6IGZ1bmN0aW9uKFxuICAgIGxlZnQ6IG51bWJlcixcbiAgICB0b3A6IG51bWJlcixcbiAgICB3aWR0aDogbnVtYmVyLFxuICAgIGhlaWdodDogbnVtYmVyLFxuICApIHtcbiAgICBsZXQga2V5Ym9hcmRTY3JlZW5ZID0gRGltZW5zaW9ucy5nZXQoJ3dpbmRvdycpLmhlaWdodDtcbiAgICBpZiAodGhpcy5rZXlib2FyZFdpbGxPcGVuVG8pIHtcbiAgICAgIGtleWJvYXJkU2NyZWVuWSA9IHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvLmVuZENvb3JkaW5hdGVzLnNjcmVlblk7XG4gICAgfVxuICAgIGxldCBzY3JvbGxPZmZzZXRZID1cbiAgICAgIHRvcCAtIGtleWJvYXJkU2NyZWVuWSArIGhlaWdodCArIHRoaXMuYWRkaXRpb25hbFNjcm9sbE9mZnNldDtcblxuICAgIC8vIEJ5IGRlZmF1bHQsIHRoaXMgY2FuIHNjcm9sbCB3aXRoIG5lZ2F0aXZlIG9mZnNldCwgcHVsbGluZyB0aGUgY29udGVudFxuICAgIC8vIGRvd24gc28gdGhhdCB0aGUgdGFyZ2V0IGNvbXBvbmVudCdzIGJvdHRvbSBtZWV0cyB0aGUga2V5Ym9hcmQncyB0b3AuXG4gICAgLy8gSWYgcmVxdWVzdGVkIG90aGVyd2lzZSwgY2FwIHRoZSBvZmZzZXQgYXQgMCBtaW5pbXVtIHRvIGF2b2lkIGNvbnRlbnRcbiAgICAvLyBzaGlmdGluZyBkb3duLlxuICAgIGlmICh0aGlzLnByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldCkge1xuICAgICAgc2Nyb2xsT2Zmc2V0WSA9IE1hdGgubWF4KDAsIHNjcm9sbE9mZnNldFkpO1xuICAgIH1cbiAgICB0aGlzLnNjcm9sbFJlc3BvbmRlclNjcm9sbFRvKHt4OiAwLCB5OiBzY3JvbGxPZmZzZXRZLCBhbmltYXRlZDogdHJ1ZX0pO1xuXG4gICAgdGhpcy5hZGRpdGlvbmFsT2Zmc2V0ID0gMDtcbiAgICB0aGlzLnByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldCA9IGZhbHNlO1xuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlclRleHRJbnB1dEZvY3VzRXJyb3I6IGZ1bmN0aW9uKG1zZzogc3RyaW5nKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbWVhc3VyaW5nIHRleHQgZmllbGQ6ICcsIG1zZyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIGBjb21wb25lbnRXaWxsTW91bnRgIGlzIHRoZSBjbG9zZXN0IHRoaW5nIHRvIGEgIHN0YW5kYXJkIFwiY29uc3RydWN0b3JcIiBmb3JcbiAgICogUmVhY3QgY29tcG9uZW50cy5cbiAgICpcbiAgICogVGhlIGBrZXlib2FyZFdpbGxTaG93YCBpcyBjYWxsZWQgYmVmb3JlIGlucHV0IGZvY3VzLlxuICAgKi9cbiAgVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgY29uc3Qge2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHN9ID0gdGhpcy5wcm9wcztcbiAgICB3YXJuaW5nKFxuICAgICAgdHlwZW9mIGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgIT09ICdib29sZWFuJyxcbiAgICAgIGAna2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcz17JHtrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzfX0nIGlzIGRlcHJlY2F0ZWQuIGAgK1xuICAgICAgICBgVXNlICdrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzPVwiJHtcbiAgICAgICAgICBrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzID8gJ2Fsd2F5cycgOiAnbmV2ZXInXG4gICAgICAgIH1cIicgaW5zdGVhZGAsXG4gICAgKTtcblxuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gbnVsbDtcbiAgICB0aGlzLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQgPSAwO1xuICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3cgPSBLZXlib2FyZC5hZGRMaXN0ZW5lcihcbiAgICAgICdrZXlib2FyZFdpbGxTaG93JyxcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsU2hvdyxcbiAgICApO1xuXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsSGlkZSA9IEtleWJvYXJkLmFkZExpc3RlbmVyKFxuICAgICAgJ2tleWJvYXJkV2lsbEhpZGUnLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxIaWRlLFxuICAgICk7XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93ID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAna2V5Ym9hcmREaWRTaG93JyxcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRTaG93LFxuICAgICk7XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAna2V5Ym9hcmREaWRIaWRlJyxcbiAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRIaWRlLFxuICAgICk7XG4gIH0sXG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93ICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3cucmVtb3ZlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxIaWRlICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUucmVtb3ZlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZFNob3cgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93LnJlbW92ZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZS5yZW1vdmUoKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFdhcm5pbmcsIHRoaXMgbWF5IGJlIGNhbGxlZCBzZXZlcmFsIHRpbWVzIGZvciBhIHNpbmdsZSBrZXlib2FyZCBvcGVuaW5nLlxuICAgKiBJdCdzIGJlc3QgdG8gc3RvcmUgdGhlIGluZm9ybWF0aW9uIGluIHRoaXMgbWV0aG9kIGFuZCB0aGVuIHRha2UgYW55IGFjdGlvblxuICAgKiBhdCBhIGxhdGVyIHBvaW50IChlaXRoZXIgaW4gYGtleWJvYXJkRGlkU2hvd2Agb3Igb3RoZXIpLlxuICAgKlxuICAgKiBIZXJlJ3MgdGhlIG9yZGVyIHRoYXQgZXZlbnRzIG9jY3VyIGluOlxuICAgKiAtIGZvY3VzXG4gICAqIC0gd2lsbFNob3cge3N0YXJ0Q29vcmRpbmF0ZXMsIGVuZENvb3JkaW5hdGVzfSBzZXZlcmFsIHRpbWVzXG4gICAqIC0gZGlkU2hvdyBzZXZlcmFsIHRpbWVzXG4gICAqIC0gYmx1clxuICAgKiAtIHdpbGxIaWRlIHtzdGFydENvb3JkaW5hdGVzLCBlbmRDb29yZGluYXRlc30gc2V2ZXJhbCB0aW1lc1xuICAgKiAtIGRpZEhpZGUgc2V2ZXJhbCB0aW1lc1xuICAgKlxuICAgKiBUaGUgYFNjcm9sbFJlc3BvbmRlcmAgbW9kdWxlIGNhbGxiYWNrcyBmb3IgZWFjaCBvZiB0aGVzZSBldmVudHMuXG4gICAqIEV2ZW4gdGhvdWdoIGFueSB1c2VyIGNvdWxkIGhhdmUgZWFzaWx5IGxpc3RlbmVkIHRvIGtleWJvYXJkIGV2ZW50c1xuICAgKiB0aGVtc2VsdmVzLCB1c2luZyB0aGVzZSBgcHJvcHNgIGNhbGxiYWNrcyBlbnN1cmVzIHRoYXQgb3JkZXJpbmcgb2YgZXZlbnRzXG4gICAqIGlzIGNvbnNpc3RlbnQgLSBhbmQgbm90IGRlcGVuZGVudCBvbiB0aGUgb3JkZXIgdGhhdCB0aGUga2V5Ym9hcmQgZXZlbnRzIGFyZVxuICAgKiBzdWJzY3JpYmVkIHRvLiBUaGlzIG1hdHRlcnMgd2hlbiB0ZWxsaW5nIHRoZSBzY3JvbGwgdmlldyB0byBzY3JvbGwgdG8gd2hlcmVcbiAgICogdGhlIGtleWJvYXJkIGlzIGhlYWRlZCAtIHRoZSBzY3JvbGwgcmVzcG9uZGVyIGJldHRlciBoYXZlIGJlZW4gbm90aWZpZWQgb2ZcbiAgICogdGhlIGtleWJvYXJkIGRlc3RpbmF0aW9uIGJlZm9yZSBiZWluZyBpbnN0cnVjdGVkIHRvIHNjcm9sbCB0byB3aGVyZSB0aGVcbiAgICoga2V5Ym9hcmQgd2lsbCBiZS4gU3RpY2sgdG8gdGhlIGBTY3JvbGxSZXNwb25kZXJgIGNhbGxiYWNrcywgYW5kIGV2ZXJ5dGhpbmdcbiAgICogd2lsbCB3b3JrLlxuICAgKlxuICAgKiBXQVJOSU5HOiBUaGVzZSBjYWxsYmFja3Mgd2lsbCBmaXJlIGV2ZW4gaWYgYSBrZXlib2FyZCBpcyBkaXNwbGF5ZWQgaW4gYVxuICAgKiBkaWZmZXJlbnQgbmF2aWdhdGlvbiBwYW5lLiBGaWx0ZXIgb3V0IHRoZSBldmVudHMgdG8gZGV0ZXJtaW5lIGlmIHRoZXkgYXJlXG4gICAqIHJlbGV2YW50IHRvIHlvdS4gKEZvciBleGFtcGxlLCBvbmx5IGlmIHlvdSByZWNlaXZlIHRoZXNlIGNhbGxiYWNrcyBhZnRlclxuICAgKiB5b3UgaGFkIGV4cGxpY2l0bHkgZm9jdXNlZCBhIG5vZGUgZXRjKS5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbFNob3c6IGZ1bmN0aW9uKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICB0aGlzLmtleWJvYXJkV2lsbE9wZW5UbyA9IGU7XG4gICAgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3cgJiYgdGhpcy5wcm9wcy5vbktleWJvYXJkV2lsbFNob3coZSk7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsSGlkZTogZnVuY3Rpb24oZTogS2V5Ym9hcmRFdmVudCkge1xuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gbnVsbDtcbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsSGlkZSAmJiB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsSGlkZShlKTtcbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZFNob3c6IGZ1bmN0aW9uKGU6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAvLyBUT0RPKDc2OTM5NjEpOiBUaGUgZXZlbnQgZm9yIERpZFNob3cgaXMgbm90IGF2YWlsYWJsZSBvbiBpT1MgeWV0LlxuICAgIC8vIFVzZSB0aGUgb25lIGZyb20gV2lsbFNob3cgYW5kIGRvIG5vdCBhc3NpZ24uXG4gICAgaWYgKGUpIHtcbiAgICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gZTtcbiAgICB9XG4gICAgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkU2hvdyAmJiB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRTaG93KGUpO1xuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkSGlkZTogZnVuY3Rpb24oZTogS2V5Ym9hcmRFdmVudCkge1xuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gbnVsbDtcbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRIaWRlICYmIHRoaXMucHJvcHMub25LZXlib2FyZERpZEhpZGUoZSk7XG4gIH0sXG59O1xuXG5jb25zdCBTY3JvbGxSZXNwb25kZXIgPSB7XG4gIE1peGluOiBTY3JvbGxSZXNwb25kZXJNaXhpbixcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU2Nyb2xsUmVzcG9uZGVyO1xuIl19