{"version":3,"sources":["YellowBoxRegistry.js"],"names":["YellowBoxWarning","require","observers","Set","ignorePatterns","registry","Map","disabled","projection","updateTimeout","isWarningIgnored","warning","pattern","message","content","includes","handleUpdate","category","warnings","filtered","filter","length","set","setImmediate","observer","YellowBoxRegistry","add","args","framesToPop","startsWith","parse","stack","get","delete","has","clear","size","addIgnorePatterns","patterns","newPatterns","setDisabled","value","isDisabled","observe","subscription","unsubscribe","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow strict-local\n * @format\n */\n\n'use strict';\n\nconst YellowBoxWarning = require('./YellowBoxWarning');\n\nimport type {Category} from './YellowBoxCategory';\n\nexport type Registry = Map<Category, $ReadOnlyArray<YellowBoxWarning>>;\n\nexport type Observer = (registry: Registry) => void;\n\nexport type Subscription = $ReadOnly<{|\n  unsubscribe: () => void,\n|}>;\n\nconst observers: Set<{observer: Observer}> = new Set();\nconst ignorePatterns: Set<string> = new Set();\nconst registry: Registry = new Map();\n\nlet disabled = false;\nlet projection = new Map();\nlet updateTimeout = null;\n\nfunction isWarningIgnored(warning: YellowBoxWarning): boolean {\n  for (const pattern of ignorePatterns) {\n    if (warning.message.content.includes(pattern)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction handleUpdate(): void {\n  projection = new Map();\n  if (!disabled) {\n    for (const [category, warnings] of registry) {\n      const filtered = warnings.filter(warning => !isWarningIgnored(warning));\n      if (filtered.length > 0) {\n        projection.set(category, filtered);\n      }\n    }\n  }\n  if (updateTimeout == null) {\n    updateTimeout = setImmediate(() => {\n      updateTimeout = null;\n      for (const {observer} of observers) {\n        observer(projection);\n      }\n    });\n  }\n}\n\nconst YellowBoxRegistry = {\n  add({\n    args,\n    framesToPop,\n  }: $ReadOnly<{|\n    args: $ReadOnlyArray<mixed>,\n    framesToPop: number,\n  |}>): void {\n    if (typeof args[0] === 'string' && args[0].startsWith('(ADVICE)')) {\n      return;\n    }\n    const {category, message, stack} = YellowBoxWarning.parse({\n      args,\n      framesToPop: framesToPop + 1,\n    });\n\n    let warnings = registry.get(category);\n    if (warnings == null) {\n      warnings = [];\n    }\n    warnings = [...warnings, new YellowBoxWarning(message, stack)];\n\n    registry.delete(category);\n    registry.set(category, warnings);\n\n    handleUpdate();\n  },\n\n  delete(category: Category): void {\n    if (registry.has(category)) {\n      registry.delete(category);\n      handleUpdate();\n    }\n  },\n\n  clear(): void {\n    if (registry.size > 0) {\n      registry.clear();\n      handleUpdate();\n    }\n  },\n\n  addIgnorePatterns(patterns: $ReadOnlyArray<string>): void {\n    const newPatterns = patterns.filter(\n      pattern => !ignorePatterns.has(pattern),\n    );\n    if (newPatterns.length === 0) {\n      return;\n    }\n    for (const pattern of newPatterns) {\n      ignorePatterns.add(pattern);\n    }\n    handleUpdate();\n  },\n\n  setDisabled(value: boolean): void {\n    if (value === disabled) {\n      return;\n    }\n    disabled = value;\n    handleUpdate();\n  },\n\n  isDisabled(): boolean {\n    return disabled;\n  },\n\n  observe(observer: Observer): Subscription {\n    const subscription = {observer};\n    observers.add(subscription);\n    observer(projection);\n    return {\n      unsubscribe(): void {\n        observers.delete(subscription);\n      },\n    };\n  },\n};\n\nmodule.exports = YellowBoxRegistry;\n"]}